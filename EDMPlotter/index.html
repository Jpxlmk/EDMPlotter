<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
    <title>Experiment Control Panel</title>
    <link rel="stylesheet" type="text/css" href="css/containerstyle.css">
    <link rel="stylesheet" type="text/css" href="css/controlpanelstyle.css">
    <link rel="stylesheet" type="text/css" href="css/d3plotstyle.css">
</head>
<body>
    <div class="controlpanel">
        <input type="button" id="plotbutton" value="Start" />
        <input type="button" id="stopplotbutton" value="Stop" />
        <input type="button" id="clearplotbutton" value="Clear" />
        <input type="button" id="savedatabutton" value="Save to" />
        <input type="text" id="savepathtextbox" value="C:\data\data.csv" />
    </div>
    <div class="container">
        <svg id="plot" width="1000" height="500"></svg>
    </div>  

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-2.2.3.min.js" ></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Reference to d3 library-->
    <script charset="utf-8" type="text/javascript" src="Scripts/d3.v3.min.js"></script>
    <!--<script src="http://d3js.org/d3.v3.js"></script>-->
    <!--Add script to plot some data.-->
    <script src="js/d3plot.js" type="text/javascript"></script>
    <script type="text/javascript">

        var params = {
            'NumberOfPoints': '1000',
            'AINames': ['x_val', 'y_val'],
            'AIAddresses': ['/dev1/ai1', '/dev1/ai2'],
            'AutoStart': 'false',
            'TriggerAddress': '/dev1/PFI0',
            'SampleRate': '200'
        };

        //These control the server's data-pushing down to the client.
        $(function () {
            // Declare a proxy to reference the hub. 
            var pHub = $.connection.plotHub;

            // Create a function that the hub can call to plot the data.
            pHub.client.pushData = function (data) {
                //I am assuming that there is an svg object with id="plot". If there isn't, this will fail.
                plotData("#" + "plot", JSON.parse(data));
            };

            pHub.client.clearData = function () {
                clearData("#" + "plot");
            }


                    // Start the connection, and start plotting!
            $.connection.hub.start().done(function () {

                $('#plotbutton').click(function () {
                    // Call the StartPlotting method on the hub. 
                    pHub.server.startPlotting(JSON.stringify(params));

                });
                    // Stop plotting
                $('#stopplotbutton').click(function () {
                    // Call the StopPlotting method on the hub. 
                    pHub.server.stopPlotting();

                });
                
                    //Clears Plot
                $('#clearplotbutton').click(function () {
                    // Call the StopPlotting method on the hub. 
                    pHub.server.clearAll();

                });

                $('#savedatabutton').click(function () {
                    pHub.server.save($('#savepathtextbox').val());
                });


            });
            
        });
    </script>
</body>
</html>